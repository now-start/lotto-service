name: lotto
on:
  workflow_dispatch:
  schedule:
    # 매 주 일요일 오후 12시, Github Actions 에서는 UTC 기준으로 실행됨
    # https://elmah.io/tools/cron-parser/
    - cron: '0 3 * * 0'

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7]

    steps:
      - uses: actions/checkout@v2
      - name: Set up python ${{ matrix.python-version }}
        uses: actions/setup-python@v1
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install python package
        run: |
          pip install selenium
          pip install requests        
          pip install twython
          pip install pillow    
          pip install gspread        
          pip install --upgrade google-api-python-client oauth2client
          pip install playwright
          python -m playwright install ${{ matrix.browser-channel }} --with-deps

      - name: Install ubuntu package
        run: |
          sudo apt-get install fonts-unfonts-core
          sudo apt-get install fonts-unfonts-extra
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add        
          sudo apt-get install google-chrome-stable    
          wget https://chromedriver.storage.googleapis.com/100.0.4896.20/chromedriver_linux64.zip
          unzip ./chromedriver_linux64.zip           

      - name: Run!
        env:
          LOTTO_ID: ${{ secrets.ID }}
          LOTTO_PASSWORD: ${{ secrets.PASSWORD }}
          GITHUB_TOKEN: ${{ github.token }}
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          python ./lotto_result.py
          python ./lotto_buy.py